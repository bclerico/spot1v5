<?php function query_opt_str($form_field_name="query", $selected_value="", $mod_str="...Query?...", $mod_flag=FALSE) {/*Returns an HTML Form INPUT SELECT snippet for query lookup selections$form_field_name: name of the SELECT input field in the form$selected_value: the value used to select the option, if it is eq NULL then $mod_str is inserted into the option list and selected$mod_str: default text for value='' if used$mod_flag: inserts value='' and $mod_str into option list*/	$opt_str = "<select dojoType=\"dijit.form.Select\" name='" . $form_field_name . "'>";		if ($selected_value == null) {		$opt_str = $opt_str . "<option value=''>" . $mod_str . "</option>";	}	elseif ($mod_flag) {		$opt_str = $opt_str . "<option value=''>" . $mod_str . "</option>";	}		if ($selected_value == "1") {		$opt_str = $opt_str . "<option value='1' selected='selected'>All Points</option>";	}	else {		$opt_str = $opt_str . "<option value='1'>All Points</option>";	}	if ($selected_value == "2") {		$opt_str = $opt_str . "<option value='2' selected='selected'>Last Point</option>";	}	else {		$opt_str = $opt_str . "<option value='2'>Last Point</option>";	}	if ($selected_value == "3") {		$opt_str = $opt_str . "<option value='3' selected='selected'>Last 24 Hours</option>";	}	else {		$opt_str = $opt_str . "<option value='3'>Last 24 Hours</option>";	}		$opt_str = $opt_str . "</select>";	return $opt_str;}function subject_opt_str($form_field_name="subject_filter", $selected_value="", $mod_str="...Subject?...", $mod_flag=FALSE) {/*Returns an HTML Form INPUT SELECT snippet for subject lookup selections$form_field_name: name of the SELECT input field in the form$selected_value: the value used to select the option, if it is eq NULL then $mod_str is inserted into the option list and selected$mod_str: default text for value='' if used$mod_flag: inserts value='' and $mod_str into option list*/	$opt_str = "<select dojoType=\"dijit.form.Select\" name='" . $form_field_name . "'>";		if ($selected_value == null) {		$opt_str = $opt_str . "<option value=''>" . $mod_str . "</option>";	}	elseif ($mod_flag) {		$opt_str = $opt_str . "<option value=''>" . $mod_str . "</option>";	}		if ($selected_value == "1") {		$opt_str = $opt_str . "<option value='1' selected='selected'>All Subjects</option>";	}	else {		$opt_str = $opt_str . "<option value='1'>All Subjects</option>";	}	if ($selected_value == "2") {		$opt_str = $opt_str . "<option value='2' selected='selected'>OK Only</option>";	}	else {		$opt_str = $opt_str . "<option value='2'>OK Only</option>";	}	if ($selected_value == "3") {		$opt_str = $opt_str . "<option value='3' selected='selected'>Risk Only</option>";	}	else {		$opt_str = $opt_str . "<option value='3'>Risk Only</option>";	}		if ($selected_value == "4") {		$opt_str = $opt_str . "<option value='4' selected='selected'>Help Only</option>";	}	else {		$opt_str = $opt_str . "<option value='4'>Help Only</option>";	}		$opt_str = $opt_str . "</select>";	return $opt_str;}function update_profile() {	$oid = -1;	$sql = "";	$rs = db_query("select oid from profile where uid = '" . $_SESSION['uid'] . "'", $_SESSION['db_host_name'], $_SESSION['db_user_id'], $_SESSION['db_password'], $_SESSION['db_name'], $_SESSION['db_port']);		while ($row = mysqli_fetch_array($rs)) {		$oid = $row['oid'];	}//	mysqli_close($_SESSION['db_name']);	mysqli_free_result($rs);		if ($oid > -1) {		$sql = "update profile SET ";		$sql = $sql . "uid = '" . $_SESSION['uid'] . "', pwd = '" . $_SESSION['pwd'] . "', email = '" . $_SESSION['email'] . "', ";		$sql = $sql . "fname = '" . $_SESSION['fname'] . "', mi = '" . $_SESSION['mi'] . "', lname = '" . $_SESSION['lname'] . "', ";		$sql = $sql . "bc_long = " . $_SESSION['bc_long'] . ", bc_lat = " . $_SESSION['bc_lat'] . ", spot_id = '" . $_SESSION['spot_id'] . "', ";		$sql = $sql . "spot_device_name = '" . $_SESSION['spot_device_name'] . "', dto = '" . dto() . "' WHERE oid = " . $oid;	}	else {		$sql = "insert into profile (uid, pwd, email, fname, mi, lname, bc_long, bc_lat, spot_id, spot_device_name, dto) ";		$sql = $sql . "VALUES ('" . $_SESSION['uid'] . "', '" . $_SESSION['pwd'] . "', '" . $_SESSION['email'] . "', '" . $_SESSION['fname'];		$sql = $sql . "', '" . $_SESSION['mi'] . "', '" . $_SESSION['lname'] . "', " . $_SESSION['bc_long'] . ", " . $_SESSION['bc_lat'];		$sql = $sql . ", '" . $_SESSION['spot_id']. "', '" . $_SESSION['spot_device_name'] . "', '" . dto() . "');";	}		$rs = db_query($sql, $_SESSION['db_host_name'], $_SESSION['db_user_id'], $_SESSION['db_password'], $_SESSION['db_name'], $_SESSION['db_port']);		error_log("clerico: " . $sql . " $rs:" . $rs);		if ($rs == "") {		return false;	}	else {		mysqli_free_result($rs);		return true;	}}function login_to_profile() {	$q = "select uid, pwd, email, fname, mi, lname, bc_long, bc_lat, spot_id, spot_device_name from profile ";	$q = $q . "where (uid = '" . $_SESSION['uid'] . "' AND pwd = '" . $_SESSION['pwd'] . "');";	$rec_found = false;		$rs = db_query($q, $_SESSION['db_host_name'], $_SESSION['db_user_id'], $_SESSION['db_password'], $_SESSION['db_name'], $_SESSION['db_port']);		while ($row = mysqli_fetch_array($rs)) {		$_SESSION['uid'] = $row['uid'];		$_SESSION['pwd'] = $row['pwd'];		$_SESSION['email'] = $row['email'];		$_SESSION['fname'] = $row['fname'];		$_SESSION['mi'] = $row['mi'];		$_SESSION['lname'] = $row['lname'];		$_SESSION['bc_long'] = $row['bc_long'];		$_SESSION['bc_lat'] = $row['bc_lat'];		$_SESSION['spot_id'] = $row['spot_id'];		$_SESSION['spot_device_name'] = $row['spot_device_name'];		$rec_found = true;	}	mysqli_free_result($rs);		return $rec_found;}function get_content($var="") {	$cnhtml="<h3>No Content Available</h3>";	$rec_found = false;		if ($var != "") {		$q = "select cnhtml from content ";		$q = $q . "where cnkey = '" . $var . "';";				$rs = db_query($q, $_SESSION['db_host_name'], $_SESSION['db_user_id'], $_SESSION['db_password'], $_SESSION['db_name'], $_SESSION['db_port']);			while ($row = mysqli_fetch_array($rs)) {			$cnhtml = $row['cnhtml'];			$rec_found = true;		}				mysqli_free_result($rs);	}		return $rec_found ? $cnhtml : $cnhtml . ">>>" . $var . "<<<";}function get_content_for_edit($oid=-1) {	$cnhtml="";	$rec_found = false;		if ($oid > -1) {		$q = "select cnhtml from content ";		$q = $q . "where oid = " . $oid . ";";				$rs = db_query($q, $_SESSION['db_host_name'], $_SESSION['db_user_id'], $_SESSION['db_password'], $_SESSION['db_name'], $_SESSION['db_port']);			while ($row = mysqli_fetch_array($rs)) {			$cnhtml = $row['cnhtml'];			$rec_found = true;		}				mysqli_free_result($rs);	}	return $rec_found ? $cnhtml : "No Content Found for>>>" . $oid . "<<<";}function get_content_for_index() {	$idx = "";	$rec_found = false;		$q = "select oid, cnkey from content order by 2;";			$rs = db_query($q, $_SESSION['db_host_name'], $_SESSION['db_user_id'], $_SESSION['db_password'], $_SESSION['db_name'], $_SESSION['db_port']);		while ($row = mysqli_fetch_array($rs)) {		$idx = $idx . "<a href='content_01.php?oid=".$row['oid']."&cnkey=".$row['cnkey']."'>".$row['cnkey']."</a><br /><br />";		$rec_found = true;	}			mysqli_free_result($rs);	return $rec_found ? $idx : "No Content Found";}function update_content($oid=-1, $key="", $html="") {	$sql = "";		if ($oid > -1) {		$sql = "update content SET ";		$sql = $sql . "cnkey = '" . $key . "', cnhtml = '" . $html . "', dto = '" . dto() . "'";		$sql = $sql . " WHERE oid = " . $oid;	}	else {		$sql = "insert into profile (cnkey, cnhtml, dto) ";		$sql = $sql . "VALUES ('" . $key . "', '" . $html . "', '" . dto() . "');";	}		$rs = db_query($sql, $_SESSION['db_host_name'], $_SESSION['db_user_id'], $_SESSION['db_password'], $_SESSION['db_name'], $_SESSION['db_port']);	//	mysqli_close($_SESSION['db_name']);	mysqli_free_result($rs);		if ($rs == "") {		return false;	}	else {		return true;	}}?>